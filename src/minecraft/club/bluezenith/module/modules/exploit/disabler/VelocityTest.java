package club.bluezenith.module.modules.exploit.disabler;

import club.bluezenith.events.Listener;
import club.bluezenith.events.impl.PacketEvent;
import club.bluezenith.events.impl.UpdatePlayerEvent;
import club.bluezenith.module.modules.misc.Debug;
import club.bluezenith.module.value.types.ExtendedModeValue;
import club.bluezenith.util.player.PacketUtil;
import net.minecraft.network.play.client.C0CPacketInput;
import net.minecraft.network.play.server.S12PacketEntityVelocity;
import net.minecraft.network.play.server.S27PacketExplosion;

import static club.bluezenith.util.MinecraftInstance.mc;

public class VelocityTest implements ExtendedModeValue.Mode {

    private int ticksSinceVelocity;

    @Listener
    public void onUpdatePlayer(UpdatePlayerEvent event) {
        if(event.isPre() && mc.thePlayer.hurtTime > 0 && ticksSinceVelocity <= 3 && ticksSinceVelocity > 0) {
            ticksSinceVelocity--;
            Debug.debug("sex");
            PacketUtil.sendSilent(new C0CPacketInput(mc.thePlayer.moveStrafing, mc.thePlayer.moveForward, mc.thePlayer.movementInput.jump, mc.thePlayer.movementInput.sneak));
        }
    }

    @Listener
    public void onPacket(PacketEvent event) {
        if(event.packet instanceof S12PacketEntityVelocity && ((S12PacketEntityVelocity) event.packet).entityID == mc.thePlayer.getEntityId()) {
            Debug.debug("received velo city");
            ticksSinceVelocity = 3;
        }
    }

}
