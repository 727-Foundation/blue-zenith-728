package club.bluezenith.module.modules.exploit;

import club.bluezenith.events.Listener;
import club.bluezenith.events.impl.UpdatePlayerEvent;
import club.bluezenith.module.Module;
import club.bluezenith.module.ModuleCategory;
import club.bluezenith.module.value.types.BooleanValue;
import club.bluezenith.module.value.types.IntegerValue;
import club.bluezenith.module.value.types.ModeValue;
import net.minecraft.block.BlockGlass;
import net.minecraft.util.BlockPos;

import static java.lang.Math.round;

public class Phase extends Module {

    final ModeValue mode = new ModeValue("Mode", "VClip", "VClip").setIndex(1);
    final BooleanValue autoClip = new BooleanValue("AutoClip", false).showIf(()-> mode.is("VClip")).setIndex(2);
    final IntegerValue clipHeight = new IntegerValue("Clip Height", -5,-10,10,1).showIf(()-> mode.is("VClip")).setIndex(3);
    final ModeValue clipDetection = new ModeValue("Clip when", "On Glass", "On Glass", "Ticks Existed").showIf(autoClip::get).setIndex(4);
    final IntegerValue ticksExisted = new IntegerValue("Ticks Existed", 25,5,300,5).showIf(()-> clipDetection.is("Ticks Existed")).setIndex(5);

    boolean clipped;

    public Phase() {
        super("Phase", ModuleCategory.EXPLOIT);
    }

    @Listener
    public void onUpdate(UpdatePlayerEvent event) {
        if(event.isPost()) return;
        if(mc.thePlayer.ticksExisted == 1) clipped = false;
        if(!clipped && autoClip.get()) {
            switch (clipDetection.get()) {
                case "On Glass":
                    if(mc.thePlayer.onGround) {
                        final boolean flag = mc.theWorld.getBlockState(new BlockPos(round(mc.thePlayer.posX), round(mc.thePlayer.posY - 1), round(mc.thePlayer.posZ))).getBlock() instanceof BlockGlass;
                        final boolean flag2 = mc.theWorld.getBlockState(new BlockPos(round(mc.thePlayer.posX), round(mc.thePlayer.posY - 2), round(mc.thePlayer.posZ))).getBlock() instanceof BlockGlass;
                        if(flag || flag2) {
                            mc.thePlayer.setPosition(mc.thePlayer.posX, mc.thePlayer.posY + clipHeight.get(), mc.thePlayer.posZ);
                            clipped = true;
                        }
                    }
                    break;

                case "Ticks Existed":
                    if(mc.thePlayer.ticksExisted == ticksExisted.get()) {
                        mc.thePlayer.setPosition(mc.thePlayer.posX, mc.thePlayer.posY + clipHeight.get(), mc.thePlayer.posZ);
                        clipped = true;
                    }
                    break;
            }
        } else if(!autoClip.get()) {
            setState(false);
        }
    }

    @Override
    public void onEnable() {
        if(!autoClip.get() && mc.thePlayer != null) {
            mc.thePlayer.setPosition(mc.thePlayer.posX, mc.thePlayer.posY + clipHeight.get(), mc.thePlayer.posZ);
        }
    }
}
